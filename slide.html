<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slide Puzzle</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43);
            color: white;
            min-height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        /* Page Containers */
        .page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        .page.active {
            display: flex;
        }
        
        /* Home Page */
        #home-page {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 30px 20px;
        }
        
        .logo {
            margin-bottom: 40px;
        }
        
        .logo-text {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #00c9ff, #92fe9d);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .logo-subtitle {
            font-size: 1.2rem;
            color: #a8d0e6;
            opacity: 0.8;
        }
        
        .home-buttons {
            width: 100%;
            max-width: 300px;
            margin-top: 20px;
        }
        
        .home-btn {
            width: 100%;
            padding: 20px;
            margin: 12px 0;
            font-size: 1.4rem;
            font-weight: 600;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .home-btn:active {
            transform: scale(0.97);
        }
        
        .play-btn {
            background: linear-gradient(45deg, #00c9ff, #92fe9d);
            color: #0f2027;
            box-shadow: 0 6px 20px rgba(0, 201, 255, 0.4);
        }
        
        .levels-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .sound-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            font-size: 1.2rem;
            padding: 16px;
        }
        
        .sound-btn.active {
            background: rgba(0, 201, 255, 0.3);
            border-color: #00c9ff;
        }
        
        .btn-icon {
            font-size: 1.6rem;
        }
        
        /* Game Page */
        #game-page {
            background: linear-gradient(135deg, #0f2027, #203a43);
        }
        
        /* Game Header */
        .game-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .game-title {
            font-size: 1.6rem;
            font-weight: bold;
            background: linear-gradient(to right, #00c9ff, #92fe9d);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: #00c9ff;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.15);
        }
        
        .stat-item {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .stat-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: #92fe9d;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #a8d0e6;
            margin-top: 2px;
        }
        
        /* Puzzle Container */
        .puzzle-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            max-height: 70vh;
        }
        
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-gap: 6px;
            width: 90vw;
            max-width: 360px;
            height: 90vw;
            max-height: 360px;
            margin: 0 auto 20px;
        }
        
        .tile {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(145deg, #2c5364, #203a43);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            border: 2px solid #3a5f9a;
        }
        
        @media (max-width: 350px) {
            .tile {
                font-size: 1.8rem;
            }
        }
        
        .tile:active {
            transform: scale(0.95);
            background: linear-gradient(145deg, #3a6ca8, #2a4c9d);
        }
        
        .tile.empty {
            background: transparent;
            border: 2px dashed #3a5f9a;
            box-shadow: none;
            cursor: default;
        }
        
        .tile.empty:active {
            transform: none;
            background: transparent;
        }
        
        .tile.correct {
            background: linear-gradient(145deg, #00c9ff, #92fe9d);
            border-color: #00c9ff;
            color: #0f2027;
        }
        
        /* Progress */
        .progress-container {
            width: 100%;
            max-width: 360px;
            margin-top: 15px;
            padding: 0 10px;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 6px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #00c9ff, #92fe9d);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #a8d0e6;
        }
        
        /* Controls - Updated for 2 buttons only */
        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .control-btn {
            padding: 18px 10px;
            font-size: 1rem;
            font-weight: bold;
            background: linear-gradient(to right, #00c9ff, #92fe9d);
            border: none;
            border-radius: 15px;
            color: #0f2027;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .control-btn:active {
            transform: scale(0.95);
        }
        
        /* Level Selector Page */
        #levels-page {
            background: linear-gradient(135deg, #0f2027, #203a43);
        }
        
        .levels-header {
            padding: 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .levels-title {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(to right, #00c9ff, #92fe9d);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }
        
        .levels-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
        }
        
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .level-btn {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 15px;
            position: relative;
        }
        
        .level-btn:active:not(.locked) {
            transform: scale(0.95);
        }
        
        .level-btn.active {
            background: linear-gradient(45deg, #00c9ff, #92fe9d);
            color: #0f2027;
        }
        
        .level-btn.completed::after {
            content: '‚úì';
            position: absolute;
            top: 8px;
            right: 8px;
            color: #92fe9d;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .level-btn.locked {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
        }
        
        .level-btn.locked::after {
            content: 'üîí';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 1rem;
        }
        
        .level-number {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .level-name {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        /* Shuffle Animation */
        .shuffling {
            animation: shufflePulse 0.5s ease-in-out infinite;
        }
        
        @keyframes shufflePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .shuffle-notice {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: #92fe9d;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 100;
            animation: fadeInOut 3s ease forwards;
            border: 2px solid #00c9ff;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }
        
        /* Win Message */
        .win-message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }
        
        .win-message.active {
            opacity: 1;
            visibility: visible;
        }
        
        .win-content {
            background: linear-gradient(135deg, #0f2027, #203a43);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 350px;
            border: 2px solid #00c9ff;
        }
        
        .win-title {
            font-size: 2rem;
            color: #92fe9d;
            margin-bottom: 20px;
        }
        
        .win-stats {
            margin: 20px 0;
            text-align: left;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
        }
        
        .win-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .win-stat:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .win-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .win-btn {
            flex: 1;
            padding: 12px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .win-btn:active {
            transform: scale(0.95);
        }
        
        .win-btn.primary {
            background: linear-gradient(to right, #00c9ff, #92fe9d);
            color: #0f2027;
        }
        
        .win-btn.secondary {
            background: transparent;
            border: 2px solid #00c9ff;
            color: #00c9ff;
        }
        
        /* Level Complete Animation */
        .level-complete-anim {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
        }
        
        .level-complete-anim.active {
            opacity: 1;
            visibility: visible;
        }
        
        .level-complete-text {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00c9ff, #92fe9d);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: levelCompleteAnim 1.5s ease forwards;
        }
        
        @keyframes levelCompleteAnim {
            0% { transform: scale(0.5); opacity: 0; }
            30% { transform: scale(1.2); opacity: 1; }
            70% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0.5); opacity: 0; }
        }
        
        /* Hide scrollbar but keep functionality */
        .levels-container::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }
        
        /* Hide on desktop */
        @media (min-width: 768px) {
            body::before {
                content: "Please open on mobile device";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #0f2027;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
                z-index: 10000;
            }
        }
    </style>
</head>
<body>
    <!-- Home Page -->
    <div id="home-page" class="page active">
        <div class="logo">
            <div class="logo-text">SLIDE PUZZLE</div>
            <div class="logo-subtitle">Arrange ‚Ä¢ Solve ‚Ä¢ Win</div>
        </div>
        
        <div class="home-buttons">
            <button class="home-btn play-btn" onclick="goToGame()">
                <span class="btn-icon">‚ñ∂</span>
                <span>PLAY GAME</span>
            </button>
            
            <button class="home-btn levels-btn" onclick="goToLevels()">
                <span class="btn-icon">üìä</span>
                <span>SELECT LEVEL</span>
            </button>
            
            <button class="home-btn sound-btn" id="sound-toggle">
                <span class="btn-icon" id="sound-icon">üîä</span>
                <span id="sound-text">SOUND ON</span>
            </button>
        </div>
    </div>
    
    <!-- Game Page -->
    <div id="game-page" class="page">
        <div class="game-header">
            <button class="back-btn" onclick="goToHome()">‚Üê Home</button>
            <div class="game-title">LEVEL <span id="current-level-display">1</span></div>
            <div style="width: 60px;"></div> <!-- Spacer for alignment -->
        </div>
        
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="move-count">0</div>
                <div class="stat-label">MOVES</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="time">00:00</div>
                <div class="stat-label">TIME</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="tiles-correct">0/15</div>
                <div class="stat-label">CORRECT</div>
            </div>
        </div>
        
        <div class="puzzle-container">
            <div class="puzzle-grid" id="puzzle-grid">
                <!-- Tiles will be generated here -->
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text">
                    <span>PROGRESS: <span id="progress-percent">0%</span></span>
                    <span>TARGET: <span id="target-moves">20</span> moves</span>
                </div>
            </div>
        </div>
        
        <!-- Only 2 buttons: Shuffle and Reset -->
        <div class="controls">
            <button class="control-btn" id="shuffle-btn">SHUFFLE</button>
            <button class="control-btn" id="reset-btn">RESET LEVEL</button>
        </div>
    </div>
    
    <!-- Levels Page -->
    <div id="levels-page" class="page">
        <div class="levels-header">
            <button class="back-btn" onclick="goToHome()">‚Üê Home</button>
            <div class="levels-title">SELECT LEVEL</div>
            <div style="color: #a8d0e6; font-size: 0.9rem;">Complete levels to unlock more</div>
        </div>
        
        <div class="levels-container">
            <div class="levels-grid" id="levels-grid">
                <!-- Level buttons will be generated here -->
            </div>
        </div>
    </div>
    
    <!-- Level Complete Animation -->
    <div class="level-complete-anim" id="level-complete-anim">
        <div class="level-complete-text" id="level-complete-text">LEVEL 1 COMPLETE!</div>
    </div>
    
    <!-- Shuffle Notice -->
    <div id="shuffle-notice" class="shuffle-notice" style="display: none;">Shuffling...</div>
    
    <!-- Win Message -->
    <div class="win-message" id="win-message">
        <div class="win-content">
            <h2 class="win-title" id="win-title">LEVEL COMPLETE!</h2>
            
            <div class="win-stats">
                <div class="win-stat">
                    <span>Level:</span>
                    <span id="final-level">1</span>
                </div>
                <div class="win-stat">
                    <span>Your Moves:</span>
                    <span id="final-moves">0</span>
                </div>
                <div class="win-stat">
                    <span>Target Moves:</span>
                    <span id="final-target-moves">20</span>
                </div>
                <div class="win-stat">
                    <span>Your Time:</span>
                    <span id="final-time">00:00</span>
                </div>
            </div>
            
            <div id="performance-rating" style="color: #92fe9d; margin: 15px 0; font-size: 1.1rem;">
                Performance: Excellent!
            </div>
            
            <div class="win-buttons">
                <button class="win-btn primary" id="next-level-btn">NEXT LEVEL</button>
                <button class="win-btn secondary" onclick="goToHome()">HOME</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            size: 4,
            emptyIndex: 15,
            moves: 0,
            time: 0,
            timer: null,
            isPlaying: false,
            tiles: [],
            winState: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, null],
            currentLevel: 1,
            unlockedLevels: 1, // Start with only level 1 unlocked
            bestMoves: Array(10).fill(null),
            bestTimes: Array(10).fill(null),
            levelCompleted: Array(10).fill(false),
            soundEnabled: true
        };
        
        // Difficulty Levels
        const difficultyLevels = [
            { level: 1, name: "Beginner", targetMoves: 20, targetTime: 60, shuffleMoves: 5 },
            { level: 2, name: "Novice", targetMoves: 25, targetTime: 75, shuffleMoves: 8 },
            { level: 3, name: "Learner", targetMoves: 30, targetTime: 90, shuffleMoves: 12 },
            { level: 4, name: "Easy", targetMoves: 35, targetTime: 105, shuffleMoves: 18 },
            { level: 5, name: "Medium", targetMoves: 40, targetTime: 120, shuffleMoves: 25 },
            { level: 6, name: "Skilled", targetMoves: 45, targetTime: 135, shuffleMoves: 35 },
            { level: 7, name: "Advanced", targetMoves: 50, targetTime: 150, shuffleMoves: 45 },
            { level: 8, name: "Expert", targetMoves: 55, targetTime: 165, shuffleMoves: 55 },
            { level: 9, name: "Master", targetMoves: 60, targetTime: 180, shuffleMoves: 65 },
            { level: 10, name: "Legend", targetMoves: 70, targetTime: 210, shuffleMoves: 80 }
        ];
        
        // DOM Elements
        const pages = {
            home: document.getElementById('home-page'),
            game: document.getElementById('game-page'),
            levels: document.getElementById('levels-page')
        };
        
        const puzzleGrid = document.getElementById('puzzle-grid');
        const moveCountEl = document.getElementById('move-count');
        const timeEl = document.getElementById('time');
        const tilesCorrectEl = document.getElementById('tiles-correct');
        const progressFill = document.getElementById('progress-fill');
        const progressPercent = document.getElementById('progress-percent');
        const targetMovesEl = document.getElementById('target-moves');
        const currentLevelDisplay = document.getElementById('current-level-display');
        const levelsGrid = document.getElementById('levels-grid');
        const winMessage = document.getElementById('win-message');
        const finalLevelEl = document.getElementById('final-level');
        const finalMovesEl = document.getElementById('final-moves');
        const finalTargetMovesEl = document.getElementById('final-target-moves');
        const finalTimeEl = document.getElementById('final-time');
        const performanceRating = document.getElementById('performance-rating');
        const soundToggle = document.getElementById('sound-toggle');
        const soundIcon = document.getElementById('sound-icon');
        const soundText = document.getElementById('sound-text');
        const levelCompleteAnim = document.getElementById('level-complete-anim');
        const levelCompleteText = document.getElementById('level-complete-text');
        const shuffleNotice = document.getElementById('shuffle-notice');
        
        // Page Navigation
        function showPage(pageId) {
            Object.keys(pages).forEach(key => {
                pages[key].classList.remove('active');
            });
            pages[pageId].classList.add('active');
        }
        
        function goToHome() {
            showPage('home');
        }
        
        function goToGame() {
            initGame();
            showPage('game');
        }
        
        function goToLevels() {
            loadLevelsGrid();
            showPage('levels');
        }
        
        // Sound Toggle
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            soundToggle.classList.toggle('active', gameState.soundEnabled);
            soundIcon.textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
            soundText.textContent = gameState.soundEnabled ? 'SOUND ON' : 'SOUND OFF';
            
            if (gameState.soundEnabled) {
                playSound('click');
            }
            
            localStorage.setItem('slidePuzzleSound', gameState.soundEnabled);
        }
        
        // Sound Effects
        function playSound(type) {
            if (!gameState.soundEnabled) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (type === 'click') {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                }
                else if (type === 'win') {
                    const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
                    const currentTime = audioContext.currentTime;
                    
                    notes.forEach((freq, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0, currentTime + index * 0.1);
                        gainNode.gain.linearRampToValueAtTime(0.1, currentTime + index * 0.1 + 0.05);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, currentTime + index * 0.1 + 0.3);
                        
                        oscillator.start(currentTime + index * 0.1);
                        oscillator.stop(currentTime + index * 0.1 + 0.3);
                    });
                }
                else if (type === 'slide') {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 300;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.15);
                }
                else if (type === 'levelUp') {
                    const notes = [659.25, 783.99, 1046.50]; // E5, G5, C6
                    const currentTime = audioContext.currentTime;
                    
                    notes.forEach((freq, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0, currentTime + index * 0.15);
                        gainNode.gain.linearRampToValueAtTime(0.1, currentTime + index * 0.15 + 0.1);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, currentTime + index * 0.15 + 0.3);
                        
                        oscillator.start(currentTime + index * 0.15);
                        oscillator.stop(currentTime + index * 0.15 + 0.3);
                    });
                }
            } catch (e) {
                console.log("Audio not supported");
            }
        }
        
        // Initialize Game with Auto-shuffle
        function initGame() {
            // Create tiles
            gameState.tiles = [];
            for (let i = 1; i <= gameState.size * gameState.size - 1; i++) {
                gameState.tiles.push(i);
            }
            gameState.tiles.push(null);
            
            // Reset stats
            gameState.moves = 0;
            gameState.time = 0;
            gameState.emptyIndex = gameState.size * gameState.size - 1;
            gameState.isPlaying = false;
            
            // Clear timer
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            // Update UI
            currentLevelDisplay.textContent = gameState.currentLevel;
            updateStats();
            renderTiles();
            
            // Hide win message
            winMessage.classList.remove('active');
            
            // Update target moves display
            const level = difficultyLevels[gameState.currentLevel - 1];
            targetMovesEl.textContent = level.targetMoves;
            
            // Auto-shuffle for 3 seconds
            autoShuffleLevel();
        }
        
        // Auto-shuffle for new level
        function autoShuffleLevel() {
            const level = difficultyLevels[gameState.currentLevel - 1];
            
            // Show shuffle notice
            shuffleNotice.style.display = 'block';
            shuffleNotice.textContent = `Level ${gameState.currentLevel} - Shuffling...`;
            
            // Add shuffling animation to tiles
            const tiles = document.querySelectorAll('.tile');
            tiles.forEach(tile => {
                tile.classList.add('shuffling');
            });
            
            // Auto-shuffle with visual effect
            let shuffleCount = 0;
            const maxShuffles = level.shuffleMoves;
            const shuffleInterval = setInterval(() => {
                if (shuffleCount >= maxShuffles) {
                    clearInterval(shuffleInterval);
                    
                    // Remove shuffling animation
                    tiles.forEach(tile => {
                        tile.classList.remove('shuffling');
                    });
                    
                    // Hide shuffle notice after a moment
                    setTimeout(() => {
                        shuffleNotice.style.display = 'none';
                    }, 500);
                    
                    // Reset timer and moves for actual gameplay
                    gameState.moves = 0;
                    gameState.time = 0;
                    updateStats();
                    return;
                }
                
                // Find all tiles adjacent to empty space
                const adjacentTiles = [];
                for (let j = 0; j < gameState.tiles.length; j++) {
                    if (isAdjacentToEmpty(j)) {
                        adjacentTiles.push(j);
                    }
                }
                
                // Randomly select one adjacent tile
                if (adjacentTiles.length > 0) {
                    const randomIndex = Math.floor(Math.random() * adjacentTiles.length);
                    const tileIndex = adjacentTiles[randomIndex];
                    
                    // Swap tile with empty space
                    swapTiles(tileIndex, gameState.emptyIndex);
                    gameState.emptyIndex = tileIndex;
                    shuffleCount++;
                    
                    // Update display occasionally for visual feedback
                    if (shuffleCount % 5 === 0) {
                        renderTiles();
                    }
                }
            }, 60); // Fast shuffling for visual effect
        }
        
        // Render Tiles
        function renderTiles() {
            puzzleGrid.innerHTML = '';
            
            for (let i = 0; i < gameState.tiles.length; i++) {
                const tileValue = gameState.tiles[i];
                const tile = document.createElement('div');
                
                tile.className = 'tile';
                if (tileValue === null) {
                    tile.classList.add('empty');
                    tile.textContent = '';
                } else {
                    tile.textContent = tileValue;
                    
                    // Check if tile is in correct position
                    if (tileValue === i + 1) {
                        tile.classList.add('correct');
                    }
                    
                    // Add touch event
                    tile.addEventListener('click', () => handleTileClick(i));
                }
                
                puzzleGrid.appendChild(tile);
            }
            
            updateProgress();
        }
        
        // Handle Tile Click
        function handleTileClick(index) {
            if (checkWin()) return;
            
            if (isAdjacentToEmpty(index)) {
                // Play slide sound
                playSound('slide');
                
                // Start timer on first move
                if (!gameState.isPlaying) {
                    startTimer();
                    gameState.isPlaying = true;
                }
                
                // Swap tiles
                swapTiles(index, gameState.emptyIndex);
                gameState.emptyIndex = index;
                gameState.moves++;
                
                updateStats();
                renderTiles();
                
                if (checkWin()) {
                    endLevel();
                }
            }
        }
        
        // Check if adjacent to empty
        function isAdjacentToEmpty(index) {
            const row = Math.floor(index / gameState.size);
            const col = index % gameState.size;
            const emptyRow = Math.floor(gameState.emptyIndex / gameState.size);
            const emptyCol = gameState.emptyIndex % gameState.size;
            
            return (Math.abs(row - emptyRow) === 1 && col === emptyCol) ||
                   (Math.abs(col - emptyCol) === 1 && row === emptyRow);
        }
        
        // Swap Tiles
        function swapTiles(index1, index2) {
            const temp = gameState.tiles[index1];
            gameState.tiles[index1] = gameState.tiles[index2];
            gameState.tiles[index2] = temp;
        }
        
        // Check Win
        function checkWin() {
            for (let i = 0; i < gameState.winState.length; i++) {
                if (gameState.tiles[i] !== gameState.winState[i]) {
                    return false;
                }
            }
            return true;
        }
        
        // Update Stats
        function updateStats() {
            moveCountEl.textContent = gameState.moves;
            updateProgress();
        }
        
        // Update Progress
        function updateProgress() {
            let correctCount = 0;
            for (let i = 0; i < gameState.tiles.length - 1; i++) {
                if (gameState.tiles[i] === i + 1) {
                    correctCount++;
                }
            }
            
            const progress = Math.round((correctCount / 15) * 100);
            progressFill.style.width = progress + '%';
            progressPercent.textContent = progress + '%';
            tilesCorrectEl.textContent = `${correctCount}/15`;
        }
        
        // Start Timer
        function startTimer() {
            if (gameState.timer) {
                clearInterval(gameState.timer);
            }
            
            gameState.timer = setInterval(() => {
                gameState.time++;
                updateTimerDisplay();
            }, 1000);
        }
        
        // Update Timer Display
        function updateTimerDisplay() {
            const minutes = Math.floor(gameState.time / 60);
            const seconds = gameState.time % 60;
            timeEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Manual Shuffle Button
        function shuffleTiles() {
            playSound('click');
            
            if (!gameState.isPlaying) {
                gameState.isPlaying = true;
                startTimer();
            }
            
            gameState.moves = 0;
            
            const level = difficultyLevels[gameState.currentLevel - 1];
            
            // Apply multiple random moves
            for (let i = 0; i < level.shuffleMoves; i++) {
                const adjacentTiles = [];
                for (let j = 0; j < gameState.tiles.length; j++) {
                    if (isAdjacentToEmpty(j)) {
                        adjacentTiles.push(j);
                    }
                }
                
                if (adjacentTiles.length > 0) {
                    const randomIndex = Math.floor(Math.random() * adjacentTiles.length);
                    const tileIndex = adjacentTiles[randomIndex];
                    
                    swapTiles(tileIndex, gameState.emptyIndex);
                    gameState.emptyIndex = tileIndex;
                }
            }
            
            updateStats();
            renderTiles();
        }
        
        // Reset Level (Restart current level)
        function resetLevel() {
            playSound('click');
            
            // Stop timer if running
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            // Reset game state
            gameState.moves = 0;
            gameState.time = 0;
            gameState.isPlaying = false;
            
            // Update display
            updateStats();
            updateTimerDisplay();
            
            // Re-initialize the level with auto-shuffle
            initGame();
        }
        
        // Load Levels Grid with Lock/Unlock System
        function loadLevelsGrid() {
            levelsGrid.innerHTML = '';
            
            difficultyLevels.forEach((level, index) => {
                const button = document.createElement('button');
                button.className = 'level-btn';
                
                const levelNumber = index + 1;
                const isUnlocked = levelNumber <= gameState.unlockedLevels;
                const isActive = gameState.currentLevel === levelNumber;
                const isCompleted = gameState.levelCompleted[index];
                
                // Set button state
                if (!isUnlocked) {
                    button.classList.add('locked');
                } else if (isActive) {
                    button.classList.add('active');
                }
                if (isCompleted) {
                    button.classList.add('completed');
                }
                
                button.innerHTML = `
                    <div class="level-number">${levelNumber}</div>
                    <div class="level-name">${level.name}</div>
                `;
                
                // Only add click event if unlocked
                if (isUnlocked) {
                    button.addEventListener('click', () => {
                        playSound('click');
                        gameState.currentLevel = levelNumber;
                        initGame();
                        showPage('game');
                    });
                }
                
                levelsGrid.appendChild(button);
            });
        }
        
        // Show Level Complete Animation
        function showLevelCompleteAnimation() {
            levelCompleteText.textContent = `LEVEL ${gameState.currentLevel} COMPLETE!`;
            levelCompleteAnim.classList.add('active');
            
            setTimeout(() => {
                levelCompleteAnim.classList.remove('active');
            }, 1500);
        }
        
        // Unlock Next Level
        function unlockNextLevel() {
            if (gameState.currentLevel < 10) {
                const nextLevel = gameState.currentLevel + 1;
                if (nextLevel > gameState.unlockedLevels) {
                    gameState.unlockedLevels = nextLevel;
                    playSound('levelUp');
                    
                    // Show level up notification
                    if (nextLevel <= 10) {
                        setTimeout(() => {
                            alert(`üéâ Level ${nextLevel} Unlocked! üéâ`);
                        }, 500);
                    }
                }
            }
        }
        
        // End Level
        function endLevel() {
            playSound('win');
            
            if (gameState.timer) {
                clearInterval(gameState.timer);
                gameState.timer = null;
            }
            
            const levelTime = gameState.time;
            const levelIndex = gameState.currentLevel - 1;
            
            // Update best scores
            if (gameState.bestMoves[levelIndex] === null || gameState.moves < gameState.bestMoves[levelIndex]) {
                gameState.bestMoves[levelIndex] = gameState.moves;
            }
            
            if (gameState.bestTimes[levelIndex] === null || levelTime < gameState.bestTimes[levelIndex]) {
                gameState.bestTimes[levelIndex] = levelTime;
            }
            
            // Mark as completed
            gameState.levelCompleted[levelIndex] = true;
            
            // Unlock next level
            unlockNextLevel();
            
            // Show level complete animation
            showLevelCompleteAnimation();
            
            // Show win message after animation
            setTimeout(() => {
                // Show win message
                const level = difficultyLevels[levelIndex];
                finalLevelEl.textContent = gameState.currentLevel;
                finalMovesEl.textContent = gameState.moves;
                finalTargetMovesEl.textContent = level.targetMoves;
                finalTimeEl.textContent = timeEl.textContent;
                
                // Performance rating
                let rating = "Excellent!";
                if (gameState.moves > level.targetMoves * 1.2) rating = "Good";
                if (gameState.moves > level.targetMoves * 1.5) rating = "Fair";
                if (levelTime > level.targetTime * 1.5) rating = "Time to improve!";
                
                performanceRating.textContent = `Performance: ${rating}`;
                
                if (gameState.currentLevel === 10) {
                    document.getElementById('win-title').textContent = "YOU WIN!";
                }
                
                winMessage.classList.add('active');
                
                // Save data
                saveData();
            }, 1600);
        }
        
        // Next Level
        function nextLevel() {
            playSound('click');
            
            if (gameState.currentLevel < 10 && gameState.currentLevel < gameState.unlockedLevels) {
                gameState.currentLevel++;
                initGame();
                winMessage.classList.remove('active');
            } else {
                // No more levels or level not unlocked
                winMessage.classList.remove('active');
                goToHome();
            }
        }
        
        // Load Saved Data
        function loadData() {
            const savedBestMoves = localStorage.getItem('slidePuzzleMobileBestMoves');
            const savedBestTimes = localStorage.getItem('slidePuzzleMobileBestTimes');
            const savedLevelCompleted = localStorage.getItem('slidePuzzleMobileLevelCompleted');
            const savedUnlockedLevels = localStorage.getItem('slidePuzzleUnlockedLevels');
            const savedSound = localStorage.getItem('slidePuzzleSound');
            
            if (savedBestMoves) gameState.bestMoves = JSON.parse(savedBestMoves);
            if (savedBestTimes) gameState.bestTimes = JSON.parse(savedBestTimes);
            if (savedLevelCompleted) gameState.levelCompleted = JSON.parse(savedLevelCompleted);
            if (savedUnlockedLevels) gameState.unlockedLevels = parseInt(savedUnlockedLevels) || 1;
            if (savedSound !== null) gameState.soundEnabled = savedSound === 'true';
            
            // Update sound toggle UI
            soundToggle.classList.toggle('active', gameState.soundEnabled);
            soundIcon.textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
            soundText.textContent = gameState.soundEnabled ? 'SOUND ON' : 'SOUND OFF';
        }
        
        // Save Data
        function saveData() {
            localStorage.setItem('slidePuzzleMobileBestMoves', JSON.stringify(gameState.bestMoves));
            localStorage.setItem('slidePuzzleMobileBestTimes', JSON.stringify(gameState.bestTimes));
            localStorage.setItem('slidePuzzleMobileLevelCompleted', JSON.stringify(gameState.levelCompleted));
            localStorage.setItem('slidePuzzleUnlockedLevels', gameState.unlockedLevels.toString());
        }
        
        // Initialize on Load
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            
            // Button Event Listeners
            document.getElementById('shuffle-btn').addEventListener('click', shuffleTiles);
            document.getElementById('reset-btn').addEventListener('click', resetLevel);
            soundToggle.addEventListener('click', toggleSound);
            document.getElementById('next-level-btn').addEventListener('click', nextLevel);
            
            // Initialize game but don't show it yet
            initGame();
            
            // Show home page by default
            showPage('home');
        });
    </script>
</body>
</html>
